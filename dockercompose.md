# ğŸ³ Jeepay é¡¹ç›® Docker æœ¬åœ°å¼€å‘æŒ‡å—ï¼ˆå›¢é˜Ÿç‰ˆï¼‰

> é€‚ç”¨äº **Jeepay æœ¬åœ°å¼€å‘ / è”è°ƒç¯å¢ƒ**
> æŠ€æœ¯æ ˆï¼š**Colima + Docker + Docker Compose**

---

## ä¸€ã€ç¯å¢ƒè¦æ±‚ï¼ˆå¿…çœ‹ï¼‰

| å·¥å…·             | æ¨èç‰ˆæœ¬    |
| -------------- | ------- |
| Docker         | æœ€æ–°ç¨³å®šç‰ˆ   |
| Docker Compose | v2+     |
| Colimaï¼ˆMacï¼‰    | æœ€æ–°      |
| JDK            | ä¸é¡¹ç›®è¦æ±‚ä¸€è‡´ |

> âš ï¸ **Mac ç”¨æˆ·ç»Ÿä¸€ä½¿ç”¨ Colimaï¼Œä¸ç›´æ¥ä½¿ç”¨ Docker Desktop**

---

## äºŒã€å¯åŠ¨ Dockerï¼ˆæœ¬åœ°ä»£ç†æ¨¡å¼ï¼‰

> é€‚ç”¨äºï¼šæ‹‰é•œåƒã€Maven / npm ä¾èµ–ä¸‹è½½ã€è®¿é—®å¤–ç½‘èµ„æº

```bash
colima start \
  --env HTTP_PROXY=http://127.0.0.1:7890 \
  --env HTTPS_PROXY=http://127.0.0.1:7890 \
  --env NO_PROXY=localhost,127.0.0.1 \
  --cpu 4 \
  --memory 6
```

ğŸ“Œ **è¯´æ˜**

* ä»£ç†ç«¯å£ `7890` è¯·æ ¹æ®ä¸ªäººä»£ç†è½¯ä»¶è°ƒæ•´
* é¦–æ¬¡å¯åŠ¨è¾ƒæ…¢ï¼Œå±æ­£å¸¸ç°è±¡

---

## ä¸‰ã€Docker Compose å¯åŠ¨æ–¹å¼ï¼ˆæ ¸å¿ƒï¼‰

### 1ï¸âƒ£ å¯åŠ¨æœåŠ¡ï¼ˆå‰å°ï¼‰

```bash
docker-compose up
```

### 2ï¸âƒ£ å¯åŠ¨æœåŠ¡ï¼ˆåå°ï¼Œæ¨èï¼‰

```bash
docker-compose up -d
```

---

## å››ã€æ„å»º & é‡å»ºç­–ç•¥ï¼ˆé‡ç‚¹ï¼‰

### ğŸ” å¸¸è§„é‡æ–°æ„å»ºï¼ˆæ¨èï¼‰

```bash
docker-compose up --build
```

é€‚ç”¨åœºæ™¯ï¼š

* ä»£ç æ›´æ–°
* Dockerfile å˜æ›´
* ä¾èµ–æœ‰è°ƒæ•´

---

### â™»ï¸ å¼ºåˆ¶é‡å»ºå®¹å™¨ï¼ˆä¸é‡æ–° build é•œåƒï¼‰

```bash
docker-compose up --force-recreate
```

---

### ğŸ’¥ å®Œå…¨é‡å»ºï¼ˆæœ€å½»åº•ï¼Œæ…ç”¨ï¼‰

```bash
docker-compose up --build --force-recreate
```

âš ï¸ **æ³¨æ„**

* å®¹æ˜“äº§ç”Ÿ `<none>` é•œåƒ
* æ„å»ºæ—¶é—´è¾ƒé•¿
* é—®é¢˜ä¸¥é‡æ—¶å†ä½¿ç”¨

---

## äº”ã€åœæ­¢ä¸æ¸…ç†æœåŠ¡

### â¹ï¸ åœæ­¢æœåŠ¡ï¼ˆä¸åˆ å®¹å™¨ï¼‰

```bash
docker-compose stop
```

---

### ğŸ—‘ï¸ åœæ­¢å¹¶åˆ é™¤å®¹å™¨ï¼ˆä¿ç•™æ•°æ®å·ï¼‰

```bash
docker-compose down
```

---

### ğŸ’£ åœæ­¢å¹¶åˆ é™¤å®¹å™¨ + æ•°æ®å·ï¼ˆæ…ç”¨ï¼‰

```bash
docker-compose down -v
```

> âš ï¸ ä¼šåˆ é™¤ Redis / MySQL æ•°æ®ï¼Œä»…åœ¨æ•°æ®å¯ä¸¢å¼ƒæ—¶ä½¿ç”¨

---

## å…­ã€çŠ¶æ€ä¸æ—¥å¿—æ’æŸ¥

### ğŸ“Š æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€

```bash
docker-compose ps
```

---

### ğŸ“„ æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—

```bash
docker-compose logs payment
```

---

### ğŸ“¡ å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆæ¨èï¼‰

```bash
docker-compose logs -f payment
```

---

## ä¸ƒã€è¿›å…¥å®¹å™¨æ’æŸ¥é—®é¢˜

```bash
docker exec -it jeepay-payment bash
```

å¦‚å®¹å™¨å†…æ—  bashï¼š

```bash
docker exec -it jeepay-payment sh
```

---

## å…«ã€é•œåƒæ¸…ç†è§„èŒƒï¼ˆå›¢é˜Ÿçº¦å®šï¼‰

### ğŸ§¹ åˆ é™¤ jeepay é¡¹ç›®ç›¸å…³é•œåƒ

```bash
docker images | grep 'jeepay-' | awk '{print $3}' | xargs -r docker rmi -f
```

---

### ğŸ§½ åˆ é™¤ `<none>` æ‚¬ç©ºé•œåƒï¼ˆå®‰å…¨ï¼‰

```bash
docker image prune -f
```

ğŸ“Œ å»ºè®®ï¼šæ¯å‘¨è‡³å°‘æ¸…ç†ä¸€æ¬¡

---

## ä¹ã€å¸¸è§å‘ & å›¢é˜Ÿçº¦å®šï¼ˆå¿…è¯»ï¼‰

### â— å®¹å™¨ç«¯å£è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰

* **å®¹å™¨ â†” å®¹å™¨é€šä¿¡**ï¼šä½¿ç”¨å®¹å™¨å†…éƒ¨ç«¯å£ï¼ˆå¦‚ Redis `6379`ï¼‰
* **å®¿ä¸»æœº â†” å®¹å™¨é€šä¿¡**ï¼šä½¿ç”¨æ˜ å°„ç«¯å£ï¼ˆå¦‚ `6380:6379`ï¼‰

---

### â— Redis / MySQL è¿æ¥è¯´æ˜

* âŒ ä¸è¦åœ¨å®¹å™¨é‡Œä½¿ç”¨ `localhost`
* âœ… ä½¿ç”¨ **æœåŠ¡å**ï¼ˆå¦‚ `redis`ã€`mysql`ï¼‰

---

### â— é•œåƒ Tag è§„èŒƒï¼ˆå»ºè®®ï¼‰

```text
jeepay-payment:1.0.0
jeepay-manager:1.0.0
```

é¿å…é•¿æœŸä½¿ç”¨ `latest`

---

## åã€æ¨èä½¿ç”¨æµç¨‹ï¼ˆæ–°äººå¿…çœ‹ï¼‰

```bash
# 1. å¯åŠ¨ Docker
colima start

# 2. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 3. æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# 4. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f payment
```

---

## åä¸€ã€ç»Ÿä¸€æ•…éšœæ’æŸ¥æµç¨‹

1. `docker-compose ps`
2. `docker-compose logs -f <service>`
3. `docker exec -it <container> bash`
4. æ£€æŸ¥ç«¯å£ / Redis / æ•°æ®åº“è¿æ¥
5. å¿…è¦
